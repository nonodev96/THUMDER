import {
  Component,
  Input,
  Output,
  EventEmitter,
  OnInit,
  AfterViewInit,
  ElementRef,
  ViewChild
} from "@angular/core";
import { Terminal } from "xterm";
// import { LigaturesAddon } from "xterm-addon-ligatures";
import { SearchAddon } from "xterm-addon-search";
import { WebglAddon } from "xterm-addon-webgl";
import { WebLinksAddon } from "xterm-addon-web-links";
import { TypeOnKeyEvent } from "../../Types";

const PIKACHU = `
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@QQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Q#BQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@QQQQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@QB@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@QQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Q@@@@@BkQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Q@@@KT;~_U@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@QQ@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@QQQa^~~~~_6@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@k>',8@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Qk;~~~~~~_K@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@QI,''''=@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@D*~~~~~~~~~%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@QQQQBQ@@@@@@@@@@@@@@@@@@@@6=''''''''a@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@Z,~~~~~~~~~;Q@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#baz|i@@@@@@@@@@QQQB#NB@@@@@@@@@@@@@@@@@@Qj;..'''''''',#@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@!:~~~~~~~~~|@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@WU}L^_',,,,j@@@@@@@@@@@QQB#Q@@@@@@@@@@@@@@@@@gi,''..'...'....v@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@#,_~~~~~~~~~j@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Ru|;~~~~~~~~~~~!@@@@@@@@@@@@QQQ@@@@@@@@@@@@@@@@@E+~,''''...''',,,:~N@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@K'~~~~~~~~~~R@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%ai;~~~~~~~~~~~~~~;D@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@X^~~_,,,''''''''_~~~~j@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@o'~~~~~~~~~|@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@WZL;~~~~~~~~~~~~~~~~~!R@@@@@@@@@@@@@@@@@@@@@@@@@@@@@A+~~~~_~:,'',,',,,~~~~~+@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@j,~~~~~~~~;w@@@QRdbddDR%NQQ@@@@@@@@@@@@@bs!~~~~~~~~~~~~~~~~~~~~;D@@@@@@@@@@@@@@@@@@@@@@@@@@@@w^~~~~~~~~:,,:_,,_~~~~~~~~D@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@E,~~~~~;+++<!~,'.'''',:_::~;!<TjPRQ@@#};~~~~~~~~~~~~~~~~~~~~~~;A@@@@@@@@@@@@@@@@@@@@@@@@@@Qm!~~~~~~~~~~,,_~~_~~~~~~~~~~z@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@R~~~~:,~''''''''''''',:~~~~~~~~~~~~+i!;~~~~~~~~~~~~~~~~~~~~~;^D@@@@@@@@@@@@@@@@@@@@@@@@@Qy;~~~~~~~~~~~~_~~~~~~~~~~~~~~~!Q@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@Qi!,'''''''''''''''',:;+*=~~~~~~~~~~~~;;;;;;;;;;;;;;;;;;;+ijD@@@@@@@@@@@@@@@@@@@@@@@@@QI;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_X@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@B7_''''''''''''''',,,;z~.+QQX!~~~~~~~~~~;;!!!!!!!!!;!i}PRQ@@@@@@@@@@@@@@@@@@@@@@@@@@@Qu;;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~z@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@Nz~'''''''''''',,,,,:~!8k''t@@QX~~~~~~~~~~;;;!!i|7fSAWQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@y^;;;;;;;;;;;;;~~~~;;~~~~~~~~~~~~~~~~=@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@Qs<^^~'''''''',,,,_~~~~~7@@@@@@QQK~~~~~~~~~~;;;;!;f@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@DL;;;;;;;;;;;;;;;;;;;;;;;;;~~~~~~~~~~~~^Q@@@@@@@
@@@@@@@@@@@@@@@@@@@@BxD= ,7',,,,,:__~~~~~~~~~;XQQQB%Do!~~~~~~~~~;;;;;;;;J@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#T;;;;;;;;;;;;;;;;;;;;;;;;;;;;;~~~~~~~~+jW@@@@@@@@
@@@@@@@@@@@@@@@@@@@%JQ@DSg*__:_;+~~~~~~~~~~~~~~?{ft|;~~~;><*i|;;;;;;;;;;;J@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Qj!;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;~~;?yW@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@D;DQQQQi~~~~~;~~~~~~~~~~?^~~~~~~~~~~<cL<**|zy7;!;;;;;;;;z@@@@@@@@@@@@@@@@@@@@@@@@@@QI!;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;!xK@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@=~zX6w=~~~~~~~~~~~~~;<vPi~~~~~~~~~~i7<<***|7zm!!!!;;;;;;;f@@@@@@@@@@@@@@@@@@@@@@@@6^;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;={bQ@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@R|;~~~~~~+*||zkayyooaPEoXY~~~~~~~~~^j*****|!7zxj;;!!!;;;;;;k@@@@@@@@@@@@@@@@@@@@@@j;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;+}%@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@WLn?~~~~~~~_~~Xoy55y5555oS~~~~~~~~~Lw!7iL|vzzzJu;;!!!!!!!;;!%@@@@@@@@@@@@@@@@@@@@@y;;;;;;;;;;;;;;;;;;;;;;;;;;;;+jR@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@%<*Tv~~~~~~~~~^koy55555y5RL~~~~~~~~^h7zzzzzzzz5T;;!!!!!!!!!!<@@@@@@@@@@@@@@@@@@@@@@m!;;!!!!!!;;;;;;;;;;;;;;;+nD@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@7*?ys~~~~~~~~~?65y5ySEayq7~~~~;;;!;!azzzzzzzuY!!!!!!!!!!!!!!w@@@@@@@@@@@@@@@@@@@@@@k;;;!!!!!!!!!!!!;;;;;^tR@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@Q7i7m?~~~~~~~~~^kma6y7v!Yz;;;;;!!!!!<}j55y}7=;;;;!!!!!!!!!!!!k@@@@@@@@@@@@@@@@@@@@@@d^;!^;;^=^!!!!!!!iw&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@QyzJy~;;;~~~;;;!ygI<^^^z7;;;;;;!!!!!!;!^=;;;;;;;;;;!!!!!!!!!^R@@@@@@@@@@@@@@@@@@@@@@g<+=!!><!^+!^iEQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@DIS;;;;;;;!!;;;Lszi?!I!;;;;;!!;;;;;;;;;;;;;;;;;;;;;!!!!!!!;=g@@@@@@@@@@@@@@@@@@@@@@g|*==<<^<iSB@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@U^!!;;;;;!!!;;;^!zv!;;;;;;;;!;;;;;;;;;;;;;;;*T|*<><>^;!!;;^D@@@@@@@@@@@@@@@@@@@@@@8L***<<j@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@Qm|;!!;;!!!!!!;;;;;;;;;;;;;;;;;;;;;;;;;^Tz*yu*'!*,_~~~;;;~;X@@@@@@@@@@@@@@@@@@@@@@D?****iB@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@#mL!!;;!!!!!!;;;;;;!;;;;;;;;;;;;;;;;u7<L+;*?;xz+~~~~~~~~|Q@@@@@@@@@@@@@@@@@@@@@Qn?||||TQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@QW65zL+;~!i;;;;;;;!!!;;;;;;;!!;;;;;;;;;;;;sR7^^+=++++^J~~~~~~~~~ymQ@@@@@@@@@@@@@@@@QKz||LLLLLizQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@QAjL!,,,_~~~~~~~~~~;;;;;;;;;;;;;;;;;;;;;;;;;;;Tv!;^===|*=+^i~~~~~~~~~;uXQ@@@@@@@@@@@@@8wcLLLLLLLiii!K@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@q7aj=:,,,::_~~~~~~~~~~~~~~~~;;;;;;;;;;;;;;;;;;;;;;;;Z|;^==j{===+=;;;~~~~~~~~!|fQ@@@@@@@@Q6JLLLLLLLLLLifqQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@dji^!!<;~~~~~~~~~~~~~~~~~~~~~~~~~~;;;;;;;;;;;;;;;;;;;;>J~~;!|}=+^!!!;;;~~~~~~~~~~<Q@@@@@RjiiiiiiiLLLLJUQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@D=^+zj=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~;;;;;;;;;;;;;;;;LT~~~~;;;;;;;!!;;~~~~~~~~~~!D@@@@RYiiiiiiiLTZ%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@!;+==*?!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*z!~~;;;;;;;;;!;~~~~~~~~~~~~j@@@@@%niiiiiIQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@J;^;~~~~~~~~~~~~~~~~~~~~;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^!~~;;;;;;;;;;~~~~~~~~~~~~~i@@@@@@B5i!7ic6@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@QQ@Q8DXonzL?=!;~~_~~~~~~z+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~;;;;;;;~~~~~~~~~~~~~~~k&@@@@@@Qy7j{tmQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@QQN%dqUXkXb;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|kg@@@@@@@NmSSamR@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@j~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~!tUQ@@@@QRESSSSSk#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Q=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~;<zQBDEZZZZSmSEq%Q@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@h_~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~;<*JdSSSSZmq%Q@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Q^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^**<mdPWQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@I,_~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~;^****qSKQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@K,,:~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~;>***<mKSmDQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Q~,,,_~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~;+*****jRwh6DQ@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Q;,,,_~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~;^<<<***f@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@!,,,:~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~;=<<<<<<<Y@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@q,,,_~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~;;^=<<<<<<<<>m@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<:~~~~~~~~~~~~~~~~~~~;;!!!!!!!;;;;;;;~~~;;;;;;!^=<<*<<<<<<<<<=d@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@D;~~~~~~~~~~~~~;;!^+<<<<<<*****<<<<>=====><<<********<<<<<<<<!Q@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@gL^!;;~~~~;;!^=<*******<<<<****<<********************<<<<<<?%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Dt<<<>><<<**********fXR#QQ@@QQNDUyz|<**************<<<<<xN@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@BXJ<********<<ijbQ@@@@@@@@@@@@@@@@Nbwjzi*<<<**<*<*?!zfX@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@QWDSIsjjoSQ@@@@@@@@@@@@@@@@@@@@@@@@@@@QQQQQqf7vcc!!B@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Niz!TsiR@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@QzzzT7Y!U@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@moz*y|K@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%7o**yiz@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@KS!?YK@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ku7;^f7@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Njg@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@QBmLu@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
`.split("\n").join("\r\n");

@Component({
  selector:    "THUMDER-xterm",
  templateUrl: "./xterm.component.html",
  styleUrls:   [ "./xterm.component.scss" ]
})
export class XtermComponent implements OnInit, AfterViewInit {
  @ViewChild("myTerminal")
  public terminalDiv: ElementRef;

  @Input()
  public data = "";

  @Output()
  public onKey = new EventEmitter<TypeOnKeyEvent>();

  private _command: string = '';
  private _isWebglEnabled: boolean = false;
  private get isWebglEnabled() {
    return this._isWebglEnabled ? 'webgl' : 'canvas';
  }

  public terminal: Terminal = new Terminal({
    fontFamily:          '"Cascadia Code", Menlo, monospace',
    theme:               { background: "#090c0f" },
    bellStyle:           "sound",
    altClickMovesCursor: true,
    cols:                200,
    rendererType:        "canvas",
    rows:                50,
  });

  private commands = {
    promise:   {
      description: 'Promise fetch pokeapi',
      f:           async () => {
        const res = await fetch("https://pokeapi.co/api/v2/pokemon/pikachu")
        const data = await res.json();
        const { name } = data;
        this.terminal.writeln(`Promise: ${name}\r\n`);
        this.prompt()
      }
    },
    image:     {
      description: 'Print image',
      f:           async () => {
        try {
          this.terminal.writeln(PIKACHU);
        } catch (err) {
          console.error(err);
        }
        this.prompt()
      }
    },
    help:      {
      description: 'Prints this help message',
      f:           () => {
        this.terminal.writeln([
          'Welcome to xterm.js! Try some of the commands below.',
          '',
          ...Object.keys(this.commands).map(e => `  ${e.padEnd(10)} ${this.commands[e].description}`)
        ].join('\n\r'));
        this.prompt();
      },
    },
    ls:        {
      description: 'Prints a fake directory structure',
      f:           () => {
        this.terminal.writeln([ 'a', 'bunch', 'of', 'fake', 'files' ].join('\r\n'));
        this.prompt();
      },
    },
    load_test: {
      description: 'Simulate a lot of data coming from a process',
      f:           () => {
        let testData = [];
        let byteCount = 0;
        for (let i = 0; i < 50; i++) {
          let count = 1 + Math.floor(Math.random() * 79);
          byteCount += count + 2;
          let data = new Uint8Array(count + 2);
          data[0] = 0x0A; // \n
          for (let i = 1; i < count + 1; i++) {
            data[i] = 0x61 + Math.floor(Math.random() * (0x7A - 0x61));
          }
          data[data.length - 1] = 0x0D; // \r
          testData.push(data);
        }
        let start = performance.now();
        for (let i = 0; i < 1024; i++) {
          for (const d of testData) {
            this.terminal.write(d);
          }
        }

        this.terminal.write('', () => {
          let time = Math.round(performance.now() - start);
          let mbs = ((byteCount / 1024) * (1 / (time / 1000))).toFixed(2);
          this.terminal.write(`\n\r\nWrote ${byteCount}kB in ${time}ms (${mbs}MB/s) using the ${this.isWebglEnabled} renderer`);
          this.prompt();
        });
      },
    }
  };

  constructor() {

  }

  ngOnInit(): void {
  }

  ngAfterViewInit(): void {
    this.terminal.open(this.terminalDiv.nativeElement);

    try {
      // this.terminal.loadAddon(new AttachAddon());
      // this.terminal.loadAddon(new LigaturesAddon());
      this.terminal.loadAddon(new WebLinksAddon((event, url) => {
        if (event.altKey) window.open(url, '_blank');
      }));
      this.terminal.loadAddon(new SearchAddon());
      this.terminal.loadAddon(new WebglAddon());
      this._isWebglEnabled = true;
    } catch (err) {
      console.error(err);
    }

    //this.terminal.writeln(this.data)
    this.terminal.writeln("Welcome to THUMDER\n");
    this.terminal.write("$ ");

    this.terminal.onKey((e) => {
      switch (e.domEvent.key) {
        case "Enter":
          this.runCommand(this._command);
          this._command = '';
          break;
        case "Backspace":
          if (this.terminal.buffer.normal.cursorX > 2) {
            this.terminal.write("\b \b");
            if (this._command.length > 0) {
              this._command = this._command.substr(0, this._command.length - 1);
            }
          }
          break;
        default: {
          if (e.key >= String.fromCharCode(0x20) && e.key <= String.fromCharCode(0x7E) || e.key >= '\u00a0') {
            this._command += e.domEvent.key;
            this.terminal.write(e.key);
          }
        }
      }
      this.onKey.emit(e);
    });
  }

  public write(text: string): void {
    this.terminal.writeln(text);
  }

  public prompt() {
    this._command = '';
    this.terminal.write('\r\n$ ');
  }

  public runCommand(text) {
    const command = text.trim().split(' ')[0];
    if (command.length > 0) {
      this.terminal.writeln('');
      if (command in this.commands) {
        this.commands[command].f()
        console.debug(this.commands[command].description);
        return;
      }
      this.terminal.writeln(`${command}: command not found`);
    }
    this.prompt();
  }

}
